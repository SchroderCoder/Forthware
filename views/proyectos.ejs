<%- include('includes/head.ejs') %>
<%- include('includes/nav.ejs') %>   
<%- include('includes/sidebar.ejs') %>   

<%  if (alert.includes("cread")) { %> 
    <%- include('includes/successalert.ejs') %>
<%  } %> 

<%  if (alert.includes("editad")) { %> 
    <%- include('includes/editalert.ejs') %>
<%  } %> 

<%  if (alert.includes("Eliminad")) { %> 
    <%- include('includes/deletealert.ejs') %>
<%  } %> 

<body style="padding-right: 0px !important;">

    <h1 class=" pt-1 font-weight-bold">Proyectos</h1>
    <div class="pl-4 pt-2" >
        <ul class="nav nav-tabs" style="border: none;" id="myTab" role="tablist">
            <li class="nav-item " role="presentation">
                <button class="nav-link active text-light" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" type="button" role="tab" aria-controls="home-tab-pane" aria-selected="true">Proyectos</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link text-light"  id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false">Etiquetas</button>
            </li>
        </ul>
        <div class="tab-content mb-5" style=" background-color: #0000004c; ;" id="myTabContent">
            <div class="tab-pane fade show active" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
                <% if (proyectos.length > 0) { %>
                        <div class="p-2">
                            <div class="row">
                                <% for (let  p of proyectos) { %>
                                    <div class="col-xl-4 col-lg-4 col-md-6 col-sm-12 pb-3 over">
                                        <div class="card rounded-top" style="width: auto;height: auto ; ">
                                            <input type="hidden" name="_csrf" id="_csrf" value="<%= csrfToken %>" >
                                            <h5 class=" text-truncate card-title bg-success text-light text-center align-middle py-2 rounded-top " style="height:10% ;"><%= p.nombre %></h5>
                                            <a type="button" id="<%= p.id_proyecto %>" data-toggle="modal" data-target="#exampleModal" onclick = "mostrarproyecto(id)"><img src="<%= p.image_url %>" class="card-img-top imagen-landscape d-block mx-auto img-fluid" alt="" onerror="this.onerror=null; this.src='/media/image-not-found-scaled.png'"></a>
                                            <div class="card-body textBlack">
                                                <div class="row">
                                                        <p class="text-truncate card-text col-sm pt-2 over mx-auto align-middle py-auto  rounded-left etiquetaInfo">Importancia:</p>
                                                        <% if (p.importancia == "Alto") { %>
                                                            <p class="text-truncate card-text bg-success col-sm px-auto over mx-auto align-middle py-auto rounded-right etiquetaInfo"><%= p.importancia %></p>
                                                        <% } %>
                                                        <% if (p.importancia == "Medio") { %>
                                                            <p class="text-truncate card-text bg-warning col-sm px-auto over mx-auto align-middle py-auto rounded-right etiquetaInfo"><%= p.importancia %></p>
                                                        <% } %>
                                                        <% if (p.importancia == "Bajo") { %>
                                                            <p class="text-truncate card-text bg-light text-dark col-sm px-auto over mx-auto align-middle py-auto rounded-right etiquetaInfo"><%= p.importancia %></p>
                                                        <% } %>
                                                </div>
                                                <div class="row pt-2"  >
                                                    <p class="text-truncate card-text col-sm pt-1 over mx-auto align-middle py-auto rounded-left etiquetaInfo " >Estatus:</p>
                                                        <% if (p.estatus == "Planeación") { %>
                                                            <p style="background-color: #9B38CA !important;" class="text-truncate card-text col-sm  over mx-auto align-middle py-auto rounded-right etiquetaInfo" ><%= p.estatus %></p>
                                                        <% } %>
                                                        <% if (p.estatus == "Diseño") { %>
                                                            <p style="background-color: #00C4D0 !important;" class="text-truncate card-text bg-success col-sm px-auto over mx-auto align-middle py-auto  rounded-right etiquetaInfo"><%= p.estatus %></p>
                                                        <% } %>
                                                        <% if (p.estatus == "Análisis") { %>
                                                            <p style="background-color: #1A02AC !important;"class="text-truncate card-text bg-success col-sm px-auto over mx-auto align-middle py-auto rounded-right etiquetaInfo"><%= p.estatus %></p>
                                                        <% } %>
                                                        <% if (p.estatus == "Pruebas") { %>
                                                            <p style="background-color: #ca3838 !important;" class="text-truncate card-text bg-success col-sm px-auto over mx-auto align-middle py-auto  rounded-right etiquetaInfo"><%= p.estatus %></p>
                                                        <% } %>
                                                        <% if (p.estatus == "Mantenimiento") { %>
                                                            <p style="background-color: #e0ce04 !important;" class="text-truncate card-text bg-success col-sm px-auto over mx-auto align-middle py-auto  rounded-right etiquetaInfo"><%= p.estatus %></p>
                                                        <% } %>
                                                        <% if (p.estatus == "Construcción") { %>
                                                            <p style="background-color: #DC6F0B !important;" class="text-truncate card-text bg-success col-sm px-auto over mx-auto align-middle py-auto rounded-right etiquetaInfo"><%= p.estatus %></p>
                                                        <% } %>
                                                        <% if (p.estatus == "Documentación") { %>
                                                            <p style="background-color: #434342 !important;" class="text-truncate card-text bg-success col-sm px-auto over mx-auto align-middle py-auto rounded-right etiquetaInfo"><%= p.estatus %></p>
                                                        <% } %>
                                                        <% if (p.estatus == "Despliegue") { %>
                                                            <p style="background-color: #0a752c !important;" class="text-truncate card-text bg-success col-sm px-auto over mx-auto align-middle py-auto rounded-right etiquetaInfo"><%= p.estatus %></p>
                                                        <% } %>
                                                        <% if (p.estatus == "Planficación") { %>
                                                            <p style="background-color: #000000 !important;" class="text-truncate card-text bg-success col-sm px-auto over mx-auto align-middle py-auto rounded-right etiquetaInfo"><%= p.estatus %></p>
                                                        <% } %>
                                                        <% if (p.estatus == "Desarrollo") { %>
                                                            <p style="background-color: #48041b !important;" class="text-truncate card-text bg-success col-sm px-auto over mx-auto align-middle py-auto  rounded-right etiquetaInfo"><%= p.estatus %></p>
                                                        <% } %>
                                                        <% if (p.estatus == "Terminado") { %>
                                                            <p style="background-color: #281091 !important;" class="card-text bg-success col-sm px-auto over mx-auto align-middle py-auto  list-group-item"><%= p.estatus %></p>
                                                        <% } %>

                                                </div>
                                                <div class="row pt-2"  >
                                                    <p class=" text-truncate card-text col-sm pt-1 over mx-auto align-middle py-auto rounded-left etiquetaInfo">Horas: </p>
                                                    <% let check %>
                                                    <% for (let h of horas) { %>
                                                        <% if (p.nombre == h.nombre && h.es_etiqueta == 0) { %>
                                                            <p style="background-color: #1a191b !important;" class="text-truncate card-text col-sm  over mx-auto align-middle py-auto  rounded-right etiquetaInfo"><%=h.horas.toFixed(2)%></p>
                                                            <% check = true; %>
                                                        <% }%>
                                                    <% } %>
                                                    <% if (check) { %>
                                                    <% } else { %>
                                                        <p style="background-color: #1a191b !important;" class="text-truncate card-text col-sm  over mx-auto align-middle py-auto  rounded-right etiquetaInfo">0</p>
                                                    <% } %> 
                                                </div>
                                
                                                <div class="row" style="height: 49px ;"  >
                                                    <%  if (p.id_empleado == idUsuario){ %>
                                                    <a  href="/proyectos/editarProyecto/<%= p.id_proyecto %>" class="btn btn-primary btn-sm mt-3 mx-auto" style=" width:25% ; display: -webkit-box; box-sizing: content-box;" role="button" aria-disabled="true">
                                                        <i class="material-icons mx-auto mb-1 " style="font-size:135%; display: block; " >edit</i>
                                                    </a>
                                                    <%} else{ %>
                                                       
                                                    <%}%>
                                                </div>
                                                <p class="card-text"></p>
                                                <!-- <a href="#" class="btn btn-primary">Go somewhere</a> -->
                                            </div>
                                        </div>
                                    </div>
                                
                        <% } %>
                        <% } else { %>
                            <h2>No hay proyectos registrados</h2>
                        <% } %>  
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
                <div class="row ">
                    <div class="col-sm over  ">
                        <div style="height: auto !important;">
                            <ul class="">
                                <div class="row text-light mx-4 mt-2 rounded" style="height: auto; width: auto; ;background-color: rgba(0, 0, 0, 0.40) ;  ">
                                    <div class="col-6 text-center text-truncate my-auto">
                                        Nombre
                                    </div>    
                                    <div class="col-3 card-text text-truncate text-center px-auto align-middle my-auto">
                                        Horas Dedicadas
                                    </div>
                                    <div class="col-3 my-auto">
                                            
                                    </div>
                                </div>  

                                <% if (etiquetas.length > 0) { %>
                                    <% for (let e of etiquetas) { %>
                                        <div class="row text-light mx-4 mt-2 rounded" style="height: 45px; width: auto; ;background-color: rgba(0, 0, 0, 0.30) ;">
                                            <div class="col-6 border-right border-light text-truncate my-auto">
                                                 <%= e.nombre %>
                                            </div>    
                                            <div class="col-3 card-text  text-center px-auto align-middle my-auto border-light border-right">
                                                <% let check %>
                                                    <% for (let h of horas) { %>
                                                        <% if (e.nombre == h.nombre && h.es_etiqueta == 1) { %>
                                                                <%=h.horas.toFixed(2)%>
                                                            <% check = true; %>
                                                        <% }%>
                                                    <% } %>
                                                    <% if (check) { %>
                                                    <% } else { %>
                                                        0
                                                    <% } %>
                                                
                                            </div>
                                            <div class="col-3 my-auto">
                                                    <a  href="/proyectos/editarEtiqueta/<%= e.id_proyecto %>" class="btn btn-primary btn-sm mx-auto my-auto" style=" width:25% ; display: -webkit-box; box-sizing: content-box;" role="button" aria-disabled="true">
                                                        <i class="material-icons mx-auto mb-1 " style="font-size:130%; display: block; " >edit</i>
                                                    </a>
                                                    
                                                
                                            </div>
                                        </div>  
                                    <%}%>                                           
                                <% } else { %>
                                    <h2>No hay Etiquetas registrados</h2>
                                <% } %> 
                            </ul>
                        </div>
                    </div> 
                </div>
                <!-- FIN DE ETIQUETAS -->
            </div>
        </div>
    </div>
    
    <% if (privilegios.indexOf('Crear etiqueta') > -1 ) { %> 
            <div>
                <li class="dropdown">
                    <a type="button" class="BotonCrear " id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >         
                        <span class="material-icons hoverCrear " style="font-size:75px;color:white; background-color: #28a745; 
                        border-radius: 50%; filter: drop-shadow(6px 2px 10px rgba(0, 0, 0, 1)); ">
                            add
                        </span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="CrearDropdown">
                        <% if (privilegios.indexOf('Crear proyecto') > -1 ) { %> 
                            <a class="dropdown-item BotonMain " href="/proyectos/crearProyecto">Proyecto</a>
                            <div class="dropdown-divider"></div>
                        <% } %>  
                        <a class="dropdown-item BotonMain" href="/proyectos/crearEtiqueta">Etiqueta</a>
                    </div>
                </li>
            </div>
    <% } %>  
</div>

<div id = "modal">
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content" id="modal_contenido">
            </div>
        </div>
    </div>
</div>

<script src = "/js/hidediv.js"></script>
<script src="/js/mostrarproyecto.js"> </script>

</body>
<%- include('includes/footer.ejs') %>
<%- include('includes/foot.ejs') %>





